image.tag: 16.1.1
startupScripts: 
  script.sh: |
      #!/bin/bash
      printf "\nEnvironment:\n"
      env | sort

      echo "Updated $LOGIN_THEME:"
      cat $LOGIN_THEME

      echo "Cleaning history"
      rm -rf /opt/jboss/keycloak/standalone/configuration/standalone_xml_history/current/*

postgresql:
  # Disable PostgreSQL dependency
  enabled: false

extraEnv: |
  - name: DB_VENDOR
    value: postgres
  - name: DB_ADDR
    value: postgres-postgresql.postgres.svc.cluster.local
  - name: DB_PORT
    value: "5432"
  - name: DB_DATABASE
    value: postgres
  - name: PROXY_ADDRESS_FORWARDING
    value: "true"
  - name: DB_USER_FILE
    value: /secrets/postgres-credentials/username
  - name: DB_PASSWORD_FILE
    value: /secrets/postgres-credentials/password

      #args: 
      #  - "-Dkeycloak.import=/realm/realm.json"

extraInitContainers: |
  - name: theme-provider  
    image: hmda/theme-provider:v2.20.7
    imagePullPolicy: Always
    command:
      - sh
    args:
      - -c
      - |
        echo "Copying theme..."
        cp -R /themes/* /theme
    volumeMounts:
      - name: theme
        mountPath: /theme
  - name: spi-provider
    image: hmda/keycloak-spi-provider:v2.7.4
    imagePullPolicy: Always
    command:
      - sh
    args:
      - -c
      - |
        echo "Copying SPI..."
        ls
        cp -rv keycloak-authenticator-hmda-4.2.1.Final.jar /spi
    volumeMounts:
      - name: spi
        mountPath: /spi

extraVolumes: |
  - name: postgres-credentials
    secret:
      secretName: postgres-credentials
  - name: realm-secret
    secret:
      secretName: realm-secret
  - name: theme
    emptyDir: {}
  - name: spi
    emptyDir: {}
extraVolumeMounts: |
  - name: realm-secret
    mountPath: "/realm/"
    readOnly: true
  - name: theme
    mountPath: /opt/jboss/keycloak/themes/hmda
  - name: spi
    mountPath: /opt/jboss/keycloak/standalone/deployments
  - name: postgres-credentials
    mountPath: /secrets/postgres-credentials
    readOnly: true

